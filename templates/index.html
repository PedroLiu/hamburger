{% extends "base.html" %}
{% block testimonials %}
<!-- testimonials -->
<!--<form method="POST" action="/api/neworder/">-->
	<div id="testimonials" class="testimonials">
		<!-- container -->
		<div class="container">
			<div class="testimonials-info">
				<h3>Testimonials</h3>
			</div>
			<div class="testimonials-grids">
				<script src="/static/jquery.js"></script>
				<script src="/static/js/responsiveslides.min.js"></script>
				<script src="/static/js/jquery.steps.min.js"></script>
				<script>

// You can also use "$(window).load(function() {"
				$(function () {
						// Slideshow 4
						$("#slider3").responsiveSlides({
auto: false,
pager: true,
nav: false,
namespace: "callbacks",
before: function () {
$('.events').append("<li>before event fired.</li>");
},
after: function () {
$('.events').append("<li>after event fired.</li>");
}
});

						$(".add").click(function() {
							n = parseInt($(this).prev().val());
							if(isNaN(n) || n<0) n=1;
							else n=n+1;
							$(this).prev().val(n);
							unit = $(this).siblings(".unit").val();
							$(this).siblings(".price").text(n*unit);
							});

$(".min").click(function() {
		n = parseInt($(this).next().val());
		if(isNaN(n) || n<1) n=0;
		else n=n-1;
		$(this).next().val(n);
		unit = $(this).siblings(".unit").val();
		$(this).siblings(".price").text(n*unit);
		});

$(".confirm").click(function(){
		// calculate total bill
		var sum = 0;
		$(".price").each(function(){
			sum += parseInt($(this).text());
			});

		// calculate details
		var order = '\n';
		var postdata = new Object;
		$(".cate-id").each(function(){
			var id = $(this).html();
			postdata[id] = new Object;
			postdata[id]['name'] = $(this).siblings(".cate-name").html();
			postdata[id]['item'] = new Array;
			})
		$(".item-name").each(function(){
			var id = $(this).parents(".testimonials-grid").children(".cate-id").html();
			var name = $(this).html();
			var num = $(this).parent().siblings(".text-box").val();
			var sid = $(this).parent().siblings(".text-box").attr("name");
			order += '\n' + name + ' x ';
			order += num;
			var tmp = new Object;
			tmp['sid'] = sid;
			tmp['name'] = name;
			tmp['num'] = parseInt(num);
			postdata[id]['item'].push(tmp);
			});
		var info = '你确定提交订单吗？\n\n总价:\t';
		info += sum;
		<!--alert(JSON.stringify(postdata))-->
		if (!confirm(info + order)) {
		return false;
		}
		$.ajax({
type:'POST',
url:'/api/neworder/',
data:JSON.stringify(postdata),
contentType: "application/json",
dataType:'text',
success:function(result){
<!--alert(JSON.stringify(result));-->
alert("提交成功！");
window.location.href = result;
},
error:function(e){
alert('!!!' + JSON.stringify(e));
}
});

});

});

				</script>

				<div id="top" class="callbacks_container">
					<ul class="rslides" id="slider3">
						{% for cate in data %}

						<li>
						<div class="testimonials-grid">
							<div class="cate-id" style="display:none">{{cate.id}}</div>
							<p><span><h1 class="cate-name">{{cate.name}}</h1></span></p><br><br>

							<div class="row">
								{% for item in cate.item %}
								<div class="col-sm-4">
									<img src="/static/images/{{item.pic}}" alt="" />
									<p><span class="item-name">{{item.name}}</span></p>
									<input class="min" name="" type="button" value="-" />
									<input class="text-box" name="{{item.sid}}" type="text" value="0" style="width:25px;" />
									<input class="add" name="" type="button" value="+" />
									&nbsp;&nbsp;&nbsp;￥<span class="price">0</span>
									<input class="unit" type="hidden" value={{item.price}} /><br><br>
								</div>
								{% endfor %}
							</div>

						</div>
						</li>
						{% endfor %}
					</ul>
				</div>
			</div>
		</div>
		<!-- //container -->
	</div>
	<div align="center">
		<input type="submit" value="点好啦~" class="confirm">
	</div>
<!-- //testimonials -->
{% endblock %}
